import json
requests = {}
Employees = ["Mary","Valentine","Amara","Faith","John"]
Managers = ["Obinna","Philip"]

class Employee() :
    def __init__(self):
        self.name = ["Mary","Valentine","Amara","Faith","John"]
        self.managers = ["Obinna","Philip"]
        self.is_logged_in = 0
        self.logged_name = ""

    def login(self) :
        if self.is_logged_in <= 0 :
           user = input("Enter name: ").strip().title()
           if user in self.name :
              print(f"You are successfully logged in as Employee ({user})")
              self.is_logged_in = self.is_logged_in + 1
              self.logged_name = user

           elif user in self.managers :
                print(f"You are successfully logged in as a Manager ({user})")
                self.is_logged_in = self.is_logged_in + 1
                self.logged_name = user

           else :
                print("Name doesn't exist!")

        elif self.is_logged_in >= 1 :
                print(f"You are already logged in as {self.logged_name}")


    def request(self) :
        if self.is_logged_in >= 1 :
           user_name = input("Enter name: ").strip().title()
           if user_name in self.name :
              if user_name == self.logged_name :
                 user_app = input("What type of application? ").strip()
                 user = input("How long do you wanna take? ").strip()
                 try :
                     with open("requests.json", "r") as j :
                          request_data = json.load(j)
                 except (FileNotFoundError, json.JSONDecodeError) :
                         request_data = {}
                 request_data.update({user_name:{"Application":user_app,"Duration" : user, "Status" : "Pending"}})
                 print("Request has been sent, kindly wait for approval")

                 with open("requests.json" , "w") as j :
                      json.dump(request_data,j,indent=4)
            
              else :
                  print(f"You are already logged in as {self.logged_name}")

           elif user_name in self.managers :
                if user_name == self.logged_name :
                   user_app = input("What type of application? ").strip()
                   user = input("How long do you wanna take? ").strip()
                   try :
                       with open("requests.json","r") as j :
                             request_data = json.load(j)
                   except (FileNotFoundError, json.JSONDecodeError) :
                         request_data = {}
                   request_data.update({user_name:{"Application":user_app, "Duration" : user, "Status" : "Approved"}})
                   print("Your request has been approved")

                   with open("requests.json" , "w") as j :
                       json.dump(request_data,j,indent=4)

                else :
                    print(f"You are already logged in as {self.logged_name}")

           else :
            print("Name doesn't exist") 
        else :
            print("Log in to access this feature!")   

class Manager(Employee) :
    def __init__(self):
        super().__init__()
        self.managers = ["Obinna","Philip"]
        self.employees = ["Mary","Valentine","Amara","Faith","John"]
               
    def approve_req(self) :
        if self.is_logged_in >= 1 :
           user_name = input("Enter name: ").strip().title()
           if user_name in self.managers: 
              if user_name == self.logged_name :
                 with open("requests.json", "r") as j :
                   a = json.load(j)
            
                 if len(a.items()) != 0:
                    for employee ,details in a.items() :
                        if details["Status"] == "Pending" :
                           print(f"Pending Request of {employee}")
                           print(details)
                           decision = input("Approve or reject: ").strip().title()
                           print(f"{employee}'s request has been {decision}ed")
                           a[employee]["Status"] = decision
                           with open("requests.json", "w") as j :
                                 json.dump(a,j)
              
                 else:
                    print("There are no requests yet")
              else :
                 print(f"You are already logged in as {self.logged_name}")
        
           elif user_name in self.employees :
               print("Way out of your league man! This is for managers only")
        
           else :
              print("Username doesn't exist!")
        else :
            print("Log in to access this feature!")
        
    

    def check_req_update(self) :
         if self.is_logged_in >= 1 :
            with open("requests.json", "r") as file :
                b = json.load(file)
                print(b)
         else :
             print("Log in to access this feature!")
        

system = Manager()

while True :
    print("Enter 1 to login")
    print("Enter 2 to apply vacation, leave or overtime")
    print("Enter 3 to Approve or Reject requests")
    print("Enter 4 to check request update")
    print("Enter 5 to quit")
    user = input("Enter choice: ").strip()
    if user == "1" :
        system.login()
    elif user == "2" :
        system.request()
    elif user == "3" :
        system.approve_req()
    elif user == "4" :
        system.check_req_update()
    elif user == "5" :
        break
    else :
        print("Invalid input!")




